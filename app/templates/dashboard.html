{% extends "base.html" %}
{% block content %}
<div class="container">
  <h2>Gemini Insights</h2>
  <div class="card">
    <p>{{ insights }}</p>
</div>


  <div class="card bg-light p-4 rounded shadow mb-4">
    <h3 class="mb-2">ğŸ’¸ Expense Roast Summary ğŸ’€</h3>
    <p>You've spent <strong>â‚¹{{ total_expenses }}</strong> this month... again. Nice ğŸ’â€â™‚ï¸</p>
    <p>Highest single expense: <strong>â‚¹{{ max_expense }}</strong> â€” were you hungry or heartbroken? ğŸ¥²</p>
    <p>Savings? What's that? You saved <strong>â‚¹{{ total_income - total_expenses }}</strong>... if you can call that saving ğŸ¤¡</p>
  </div>
   

  <div class="mb-3 text-end">
    <a href="{{ url_for('expenses.add_expense') }}" class="btn btn-primary">
      + Add Expense
    </a>
  </div>

  <div class="alert alert-info">
    Total Spent: â‚¹{{ total_amount }}
  </div>

  <h4>Expenses</h4>
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Date</th>
        <th>Description</th>
        <th>Category</th>
        <th>Amount (â‚¹)</th>
        <th>Actions</th> 
        <th>Reaction</th>
      </tr>
    </thead>
    <tbody>
      {% for exp in expenses %}
<tr>
  <td>{{ exp.date.strftime('%Y-%m-%d') }}</td>
  <td>{{ exp.title }}</td>
  <td>{{ exp.category }}</td>
  <td>{{ exp.amount }}</td>
  <td>
    <form action="{{ url_for('expenses.delete_expense', expense_id=exp.id) }}" method="POST" onsubmit="return confirm('Are you sure you want to delete this expense?');">
      <button type="submit" class="btn btn-sm btn-danger">Delete</button>
    </form>
  </td>
  <td>
    <a href="{{ url_for('expenses.edit_expense', expense_id=exp.id) }}" class="btn btn-sm btn-primary">Edit</a>
    <form action="{{ url_for('expenses.delete_expense', expense_id=exp.id) }}" method="POST" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this expense?');">
      <button type="submit" class="btn btn-sm btn-danger">Delete</button>
    </form>
  </td>
  <td>
    {{ exp.reaction or 'ğŸ˜' }}
    <form action="{{ url_for('expenses.react_to_expense', expense_id=exp.id) }}" method="POST" style="display:inline;">
      <select name="emoji" onchange="this.form.submit()" class="form-select form-select-sm">
        <option value="">ğŸ’¬</option>
        <option value="ğŸ‘">ğŸ‘</option>
        <option value="â¤ï¸">â¤ï¸</option>
        <option value="ğŸ˜‚">ğŸ˜‚</option>
        <option value="ğŸ˜®">ğŸ˜®</option>
        <option value="ğŸ’¸">ğŸ’¸</option>
      </select>
    </form>
    <form method="POST" action="/update_income">
      <label for="income">Total Monthly Income:</label>
      <input type="number" step="0.01" name="income" required>
      <button type="submit">Save</button>
    </form>
    {% if income %}
  <p>Total Income: â‚¹{{ income }}</p>
  <p>Total Savings: â‚¹{{ savings }}</p>
  <p>Savings Rate: {{ (savings / income * 100) | round(2) }}%</p>
{% endif %}

       
  </td>
  
  
</tr>
{% endfor %}

    </tbody>
  </table>

  <h4>Category-wise Summary</h4>
  <canvas id="categoryChart" width="400" height="200"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ctx = document.getElementById('categoryChart').getContext('2d');
  const chart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: {{ category_summary | map(attribute=0) | list | tojson }},
      datasets: [{
        label: 'â‚¹ Spent',
        data: {{ category_summary | map(attribute=1) | list | tojson }},
        backgroundColor: 'rgba(75, 192, 192, 0.6)'
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: false }
      }
    }
  });
</script>
{% endblock %}
